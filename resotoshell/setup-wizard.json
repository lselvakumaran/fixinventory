{
    "config": "resoto.worker",
    "steps": [
        {
            "kind": "info",
            "name": "Resoto",
            "help": "**Welcome to Resoto!**\n\nThis wizard will help you setting up your installation.\n\nYou can navigate through the steps using the mouse or buttons:\n- Up/Down + Space: change a selection.\n- Tab/Shift+Tab: go to the next/previous element\n- Esc: Go back one decision.\n- F4: to exit the wizard at any time."
        },
        {
            "kind": "decision",
            "name": "Resoto: Which clouds do you use?",
            "help": "Resoto is able to talk to different cloud providers.\nIn order to setup the system, you need to select at least one provider.\nPlease select the ones you use.",
            "select_multiple": true,
            "step_options": {
                "AWS": {
                    "kind": "seq",
                    "name": "AWS",
                    "help": "Configure AWS Collector",
                    "patches": [
                        {
                            "action": "merge",
                            "path": "resotoworker.collector",
                            "value": [
                                "aws"
                            ]
                        }
                    ],
                    "steps": [
                        {
                            "kind": "decision",
                            "name": "AWS: how to access your AWS account(s)?",
                            "help": "AWS allows several access methods to connect to your account(s). Which one do you want to use?",
                            "select_multiple": false,
                            "step_options": {
                                "Resoto is running on a machine with a configured InstanceProfile": {
                                    "kind": "info",
                                    "name": "InstanceProfile",
                                    "help": "Using an instance profile does not require any additional configuration.\n\nPlease make sure the permissions are set correctly in IAM for the instance ResotoWorker is running on.",
                                    "links": {
                                        "AWS Instance Profile": "https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2_instance-profiles.html"
                                    }
                                },
                                "AWS access environment variables are provided to Resoto": {
                                    "kind": "info",
                                    "name": "Environment Variables",
                                    "help": "Using environment variables does not require any additional configuration.\n\nPlease make sure the variables are available to the ResotoWorker process.",
                                    "links": {
                                        "AWS Access": "https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html#environment-variables"
                                    }
                                },
                                "I have an AWS AccessKey and Secret Key": {
                                    "kind": "seq",
                                    "name": "Access+Secret Key",
                                    "help": "Configure Access and Secret Key",
                                    "steps": [
                                        {
                                            "kind": "input",
                                            "name": "AWS Access Key",
                                            "help": "Enter the AWS Access Key",
                                            "action": {
                                                "action": "replace",
                                                "path": "aws.access_key_id",
                                                "value_template": "\"@value@\""
                                            }
                                        },
                                        {
                                            "kind": "input",
                                            "name": "AWS Secret Key",
                                            "help": "Enter the AWS Secret Key",
                                            "password": true,
                                            "action": {
                                                "action": "replace",
                                                "path": "aws.secret_access_key",
                                                "value_template": "\"@value@\""
                                            }
                                        }
                                    ]
                                },
                                "I would like to use AWS Profiles (usually located at ~/.aws/config)": {
                                    "kind": "input",
                                    "name": "AWS Profile(s) to use",
                                    "help": "Enter the name of your profile. You can enter multiple profiles separated by a comma.",
                                    "action": {
                                        "action": "replace",
                                        "path": "aws.profiles",
                                        "value_template": "\"@value@\""
                                    },
                                    "split_result_by": ","
                                },
                                "The Option I would like to use is not listed here": {
                                    "kind": "info",
                                    "name": "Sorry",
                                    "help": "This setup wizard is able to handle the most common cases to connect to AWS. It looks we did not cover your use case. Since most options to connect to AWS are implemented, you might be able tp configure the access yourself by adjusting the configuration.",
                                    "links": {
                                        "AWS Access": "https://resoto.com/docs/getting-started/configure-cloud-provider-access/aws"
                                    },
                                    "is_terminal": true
                                }
                            }
                        },
                        {
                            "kind": "input",
                            "name": "AWS: scrape organizations?",
                            "help": "Do you want to scrape your accounts from the organizations? Scraping the organization requires specific permissions. Please find additional information using the links below.",
                            "links": {
                                "Setup AWS": "https://resoto.com/docs/getting-started/configure-cloud-provider-access/aws",
                                "AWS IAM": "https://docs.aws.amazon.com/organizations/latest/userguide/orgs_security_iam.html"
                            },
                            "action": {
                                "action": "replace",
                                "path": "aws.scrape_org",
                                "value_template": "@value@",
                                "default": false
                            },
                            "value_options": {
                                "yes": "true",
                                "no": "false"
                            }
                        },
                        {
                            "kind": "input",
                            "name": "AWS: Which accounts to scrape?",
                            "help": "It is possible to scrape different accounts. Since the organization should not be scraped, do you want to define the list of accounts to scrape? If yes, enter all account ids separated by comma",
                            "action": {
                                "action": "replace",
                                "path": "aws.account",
                                "value_template": "\"@value@\""
                            },
                            "only_if": [
                                {
                                    "kind": "value",
                                    "path": "aws.scrape_org",
                                    "value": false
                                }
                            ],
                            "split_result_by": ","
                        },
                        {
                            "kind": "input",
                            "name": "AWS: use a specific role?",
                            "help": "In case you have setup a role that Resoto should assume, enter the role name here. A role is not required, leave the field empty if you do not want to use a role.",
                            "action": {
                                "action": "replace",
                                "path": "aws.role",
                                "value_template": "\"@value@\""
                            },
                            "only_if": [
                                {
                                    "kind": "len",
                                    "path": "aws.profiles",
                                    "op": "<=",
                                    "value": 1
                                }
                            ]
                        }
                    ]
                },
                "GCP": {
                    "kind": "seq",
                    "name": "GCP",
                    "help": "Configure Google Cloud Collector",
                    "patches": [
                        {
                            "action": "merge",
                            "path": "resotoworker.collector",
                            "value": [
                                "gcp"
                            ]
                        }
                    ],
                    "steps": [
                        {
                            "kind": "decision",
                            "name": "GCP: how to access your GCP account(s)?",
                            "help": "Google Cloud is using service account files in order to connect to an account. Resotoworker needs access to such a file to scrape the account. If you have multiple accounts, you need to provide a service account file for each account.\n\nIf Resoto is running inside Google Cloud, it is possible to autodetect the accounts to scrape. In this case permissions need to be set for the instance Resoto is running on. See links for more information.",
                            "links": {
                                "GCP Access": "https://resoto.com/docs/getting-started/configure-cloud-provider-access/gcp",
                                "Service Account": "https://cloud.google.com/iam/docs/creating-managing-service-account-keys"
                            },
                            "select_multiple": false,
                            "step_options": {
                                "Discover GCP projects automatically": {
                                    "kind": "decision",
                                    "name": "Additional GCP Project(s) to scrape",
                                    "help": "",
                                    "patches": [
                                        {
                                            "action": "replace",
                                            "path": "gcp.service_account",
                                            "value": [
                                                ""
                                            ]
                                        }
                                    ],
                                    "step_options": {
                                        "Everything is fine.": {
                                            "kind": "info",
                                            "name": "GCP",
                                            "help": "Resoto will detect the accounts to scrape based on the instance profile ResotoWorker is running on.\n\nYou are all set!"
                                        },
                                        "Add additional GCP service account files": {
                                            "kind": "sub_interaction",
                                            "name": "Additional GCP Service Account(s)",
                                            "help": "Add additional GCP service account files",
                                            "path": "gcp.service_account",
                                            "patch_action": "merge",
                                            "steps": [
                                                {
                                                    "kind": "input",
                                                    "name": "GCP Service Account File",
                                                    "help": "Enter the path to the GCP service account file. Please make sure that this file is accessible to ResotoWorker.",
                                                    "links": {
                                                        "GCP Access": "https://resoto.com/docs/getting-started/configure-cloud-provider-access/gcp",
                                                        "Service Account": "https://cloud.google.com/iam/docs/creating-managing-service-account-keys"
                                                    },
                                                    "action": {
                                                        "path": "",
                                                        "action": "replace",
                                                        "value_template": "\"@value@\""
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                "Use service account file(s) to connect": {
                                    "kind": "sub_interaction",
                                    "name": "GCP: Define Service Account(s)",
                                    "help": "Add additional GCP service account files",
                                    "path": "gcp.service_account",
                                    "patch_action": "merge",
                                    "steps": [
                                        {
                                            "kind": "input",
                                            "name": "GCP: Service Account(s)",
                                            "help": "Enter the path to the GCP service account file. Please make sure that this file is accessible to ResotoWorker.",
                                            "links": {
                                                "GCP Access": "https://resoto.com/docs/getting-started/configure-cloud-provider-access/gcp",
                                                "Service Account": "https://cloud.google.com/iam/docs/creating-managing-service-account-keys"
                                            },
                                            "action": {
                                                "path": "",
                                                "action": "replace",
                                                "value_template": "\"@value@\""
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                },
                "Kubernetes": {
                    "kind": "seq",
                    "name": "Kubernetes",
                    "help": "Configure Kubernetes Collector",
                    "patches": [
                        {
                            "action": "merge",
                            "path": "resotoworker.collector",
                            "value": [
                                "k8s"
                            ]
                        }
                    ],
                    "steps": [
                        {
                            "kind": "decision",
                            "name": "Kubernetes: how to access your Kubernetes cluster(s)?",
                            "help": "The simplest way to connect to your cluster is using a kubeconfig file. For this method to work, resotoworker needs to have access to the configured file. In case this is not possible, or difficult to achieve, you can configure the access directly",
                            "select_multiple": false,
                            "step_options": {
                                "Resoto has access to a kubeconfig file": {
                                    "kind": "sub_interaction",
                                    "name": "Kubernetes: more kubeconfig files?",
                                    "help": "Do you have more kubeconfig files to access other Kubernetes clusters?",
                                    "path": "k8s.config_files",
                                    "steps": [
                                        {
                                            "kind": "input",
                                            "name": "Kubernetes: access via kubeconfig file",
                                            "help": "Resoto can use a kubeconfig file to access your Kubernetes cluster(s). Please enter the path to the kubeconfig file.",
                                            "action": {
                                                "action": "replace",
                                                "path": "path",
                                                "value_template": "\"@value@\""
                                            }
                                        }
                                    ]
                                },
                                "Configure the access directly": {
                                    "kind": "sub_interaction",
                                    "name": "Kubernetes: more cluster configurations?",
                                    "help": "Do you have more cluster configurations to add?",
                                    "path": "k8s.configs",
                                    "steps": [
                                        {
                                            "kind": "input",
                                            "name": "Kubernetes access: name of the cluster",
                                            "help": "Please enter the name of the cluster. This name can be chosen freely, but should be unique.",
                                            "action": {
                                                "action": "replace",
                                                "path": "name",
                                                "value_template": "\"@value@\""
                                            }
                                        },
                                        {
                                            "kind": "input",
                                            "name": "Kubernetes access: server url",
                                            "help": "Please enter the url of the Kubernetes API server. This is usually something like `https://<ip>:<port>` Example: `https://k8s-cluster-server.example.com`",
                                            "action": {
                                                "action": "replace",
                                                "path": "server",
                                                "value_template": "\"@value@\""
                                            }
                                        },
                                        {
                                            "kind": "input",
                                            "name": "Kubernetes access: certificate authority data",
                                            "help": "Please enter the certificate authority data. This is the base64 encoded certificate authority data of the cluster. You can find this data in the kubeconfig file in the related cluster section. Only required in case of a custom certificate. Leave the field empty, if this is not the case.",
                                            "action": {
                                                "action": "replace",
                                                "path": "certificate_authority_data",
                                                "value_template": "\"@value@\""
                                            }
                                        },
                                        {
                                            "kind": "input",
                                            "name": "Kubernetes access: access token",
                                            "help": "Please enter the personal user access token.",
                                            "action": {
                                                "action": "replace",
                                                "path": "token",
                                                "value_template": "\"@value@\""
                                            }
                                        }
                                    ]
                                }
                            }
                        }
                    ]
                },
                "Digital Ocean": {
                    "kind": "seq",
                    "name": "Digital Ocean",
                    "help": "Configure DigitalOcean Collector",
                    "patches": [
                        {
                            "action": "merge",
                            "path": "resotoworker.collector",
                            "value": [
                                "digitalocean"
                            ]
                        }
                    ],
                    "steps": [
                        {
                            "kind": "sub_interaction",
                            "name": "DigitalOcean: more cluster tokens?",
                            "help": "Do you have more cluster tokens to add?",
                            "path": "digitalocean.api_tokens",
                            "steps": [
                                {
                                    "kind": "input",
                                    "name": "DigitalOcean: access token",
                                    "help": "Please enter the token to access your account. You can visit the following URL to retrieve the access token.",
                                    "links": {
                                        "DigitalOcean": "https://cloud.digitalocean.com/account/api/tokens"
                                    },
                                    "action": {
                                        "action": "replace",
                                        "path": "",
                                        "value_template": "\"@value@\""
                                    }
                                }
                            ]
                        }
                    ]
                }
            }
        },
        {
            "kind": "info",
            "name": "Resoto: configuration summary",
            "help": "**You made it!**\n\nConfiguration is now getting updated and a collection run is triggered.\n",
            "commands": [
                {
                    "kind": "put_config"
                },
                {
                    "kind": "execute",
                    "command": "workflows run collect"
                }
            ]
        },
        {
            "kind": "progress",
            "name": "Resoto: Collect",
            "help": "Resoto is now connecting to the cloud providers you have configured and collects resource data.\n\nThis may take a while, depending on the number of accounts, regions and amount of data to collect."
        },
        {
            "kind": "info",
            "name": "Resoto: Setup of your system done.",
            "help": "The system has been setup according to your configuration. If you want to refine your configuration, you can do so with\n\n```> config edit resoto.worker```\n\nIf you have any comments, ideas or face any issues, please join our Discord channel and let us know!\n\nYou can now start using Resoto. Have a great day!",
            "links": {
                "GitHub": "https://github.com/someengineering/resoto",
                "Docs": "https://resoto.com",
                "Discord": "https://discord.gg/someengineering"
            }
        }
    ]
}