{
    "provider": "aws",
    "service": "ecr",
    "checks": [
        {
            "name": "image_scan_on_push",
            "title": "Check if ECR image scan on push is enabled.",
            "result_kinds": "aws_ecr_repository",
            "categories": [],
            "risk": "Amazon ECR image scanning helps in identifying software vulnerabilities in your container images. Amazon ECR uses the Common Vulnerabilities and Exposures (CVEs) database from the open-source Clair project and provides a list of scan findings. ",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_ecr_repository) and image_scan_on_push = false"
            },
            "remediation": {
                "text": "Enable ECR image scanning and review the scan findings for information about the security of the container images that are being deployed.",
                "url": "https://docs.aws.amazon.com/AmazonECR/latest/userguide/image-scanning.html"
            }
        },
        {
            "name": "repository_prohibit_public_access",
            "title": "Ensure that ECR repositories are not publicly accessible to mitigate security risks, prevent unauthorized access, and maintain control over container image distribution.",
            "result_kinds": [ "aws_ecr_repository" ],
            "categories": [
                "security",
                "compliance"
            ],
            "risk": "ECR repositories contain code bases and application artifacts, thus its imperative that they be secure and not publicly accessible",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_ecr_repository) and repository_visibility==public"
            },
            "remediation": {
                "text": "Delete public repositories and redeploy them as private.",
                "url": "https://docs.aws.amazon.com/AmazonECR/latest/userguide/repository-create.html"
            }
        },
        {
            "name": "repository_lifecycle_policy_enabled",
            "title": "Check if ECR repositories have lifecycle policies enabled.",
            "result_kinds": [ "aws_ecr_repository" ],
            "categories": [ "security", "compliance" ],
            "risk": "Amazon ECR repositories run the risk of retaining huge volumes of images, increasing unnecessary cost.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_ecr_repository) and lifecycle_policy!=null"
            },
            "remediation": {
                "text": "Open the Amazon ECR console. Create an ECR lifecycle policy.",
                "url": "https://docs.aws.amazon.com/AmazonECR/latest/userguide/LifecyclePolicies.html"
            }
        }
    ]
}
