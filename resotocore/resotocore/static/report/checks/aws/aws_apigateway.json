{
    "provider": "aws",
    "service": "apigateway",
    "checks": [
        {
            "name": "authorizers_enabled",
            "title": "Ensure API Gateway is Configured with Authorizers",
            "result_kinds": ["aws_apigateway_rest_api"],
            "categories": ["security", "compliance"],
            "risk": "Without a defined authorizer, your service could be exposed to unsanctioned use. This lack of control poses a security risk and can lead to unauthorized access and misuse.",
            "severity": "medium",
            "url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html",
            "detect": {
                "resoto": "is(aws_apigateway_rest_api) with(empty, --> is(aws_apigateway_authorizer))"
            },
            "remediation": {
                "text": "Implement an authorizer by adding an Amazon Cognito user pool or attaching an AWS Lambda function. This will provide controlled access for users interacting with your API.",
                "url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html"
            }
        },
        {
            "name": "client_certificate_enabled",
            "title": "Ensure that Client Certificate is Enabled on API Gateway for Backend Endpoint Access",
            "result_kinds": ["aws_apigateway_stage"],
            "categories": ["security", "compliance"],
            "risk": "Without client certificate enforcement, potential 'man-in-the-middle' attacks can occur, jeopardizing data integrity and confidentiality. Unsecured API calls may also be intercepted, leading to unauthorized data access.",
            "severity": "medium",
            "url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-mutual-tls.html",
            "detect": {
                "resoto": "is(aws_apigateway_stage) and stage_client_certificate_id==null <-[2]- is(aws_apigateway_rest_api)"
            },
            "remediation": {
                "text": "Enable the client certificate and implement mutual TLS for secure data transit. Mutual TLS is highly recommended for B2B applications, adhering to norms such as Open Banking. Amazon API Gateway provides integral mutual TLS authentication at no additional cost.",
                "url": "https://aws.amazon.com/blogs/compute/introducing-mutual-tls-authentication-for-amazon-api-gateway/"
            }
        },
        {
            "name": "logging_enabled",
            "title": "Ensure API Gateway Stages Have Logging Enabled",
            "result_kinds": ["aws_apigateway_stage"],
            "categories": ["compliance"],
            "risk": "Without enabling logging, you compromise on the visibility and traceability of your service usage, potentially missing crucial operational insights, security vulnerabilities, and debugging information.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_apigateway_stage) and stage_method_settings!={}"
            },
            "remediation": {
                "text": "To remediate, ensure you enable monitoring in all parts of your AWS solution. Particularly, ensure CloudTrail is active for logging API Gateway actions, which can offer insights like the nature of requests, originating IP address, the executor of the request, and more.",
                "url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/security-monitoring.html"
            },
            "url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/logging-and-monitoring.html"
        },
        {
            "name": "waf_acl_attached",
            "title": "Ensure API Gateway Has a WAF ACL Attached.",
            "result_kinds": ["aws_apigateway_stage"],
            "categories": ["security"],
            "risk": "Without a WAF ACL, API Gateway could be exposed to common web threats such as SQL injection and XSS attacks. These could compromise security, affect availability and performance, and consume excessive resources.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_apigateway_stage) and stage_web_acl_arn==null"
            },
            "remediation": {
                "text": "Mitigate this risk by using AWS WAF to protect your API Gateway from threats. AWS WAF can block these common web attacks, safeguarding both service performance and security.",
                "url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-aws-waf.html"
            },
            "url": "https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-control-access-aws-waf.html"
        }
    ]
}
