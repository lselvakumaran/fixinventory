{
    "provider": "aws",
    "service": "Secretsmanager",
    "checks": [
        {
            "name": "secret_rotation_enabled",
            "title": "Secrets Manager secrets should have automatic rotation enabled.",
            "result_kind": ["aws_secretsmanager_secret"],
            "categories": [ "compliance" ],
            "risk": "Not rotating secrets on a regular schedule will eventually extend the period a secret is active, and potentially increase the business impact if the secret is compromised.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_secretsmanager_secret) and rotation_enabled==false"
            },
            "remediation": {
                "text": "Enable automatic rotation for the secret.",
                "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
            }
        },
        {
            "name": "secret_not_used_90d",
            "title": "Secrets not used in the last 90days.",
            "result_kind": ["aws_secretsmanager_secret"],
            "categories": [ "compliance" ],
            "risk":   "Ensure there are no unused Secrets for older/defunct applications/workloads not currently in use due to potential unauthorized access, lack of tracking or auditing of those secrets, non-compliance with data retention policies, and increased exposure time for potential breaches.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_secretsmanager_secret) and last_accessed_date<{{secret_too_old_age.from_now}}"
            },
            "default_values": {
                "secret_too_old_age": "90d"
            },
            "remediation": {
                "text": "Retrieves the details of a secret. It does not include the encrypted secret value and can be used to view LastAccessedDate",
                "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
            }
        },
        {
            "name": "secret_not_changed_90d",
            "title": "Secrets not changed in the last 90days",
            "result_kind": ["aws_secretsmanager_secret"],
            "categories": [ "compliance" ],
            "risk":   "Not accessing a secret hints, that the secret is no longer in used and can be removed.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_secretsmanager_secret) and last_changed_date<{{secret_too_old_age.from_now}}"
            },
            "default_values": {
                "secret_too_old_age": "90d"
            },
            "remediation": {
                "text": "Setup automated or manual remediation to rotate old/expired credentials.",
                "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
            }
        },
        {
            "name": "secret_rotated_as_scheduled",
            "title": "Ensure no issues with rotation if manual",
            "result_kinds": ["aws_account"],
            "categories": ["security", "compliance"],
            "risk": "Ensure there are no errors or issues with secrets rotation",
            "severity": "medium",
            "detect": {
                "manual": "For AWS Secrets, you can use the CLI to describe Secrets and see when was the last time the secrets were rotated, ensuring that there is no issue with manual/automatic rotation"
            },
            "remediation": {
                "text": "Retrieves the details of a secret. It does not include the encrypted secret value and can be used to view LastRotatedDate",
                "url": "https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_DescribeSecret.html"
            },
            "source": "saad"
        }
    ]
}
