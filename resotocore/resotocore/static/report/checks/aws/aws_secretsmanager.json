{
    "provider": "aws",
    "service": "secretsmanager",
    "checks": [
        {
            "name": "secret_rotation_enabled",
            "title": "Ensure Secrets Manager secrets have automatic rotation enabled",
            "result_kinds": ["aws_secretsmanager_secret"],
            "categories": ["compliance"],
            "risk": "Not enabling automatic rotation for Secrets Manager secrets may lead to extended periods of active secrets and increased business impact if compromised.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_secretsmanager_secret) and rotation_enabled==false"
            },
            "remediation": {
                "text": "To fix this issue, enable automatic rotation for the secret.",
                "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
            },
            "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
        },
        {
            "name": "secret_not_used_90d",
            "title": "Ensure no unused Secrets in the last 90 days",
            "result_kinds": ["aws_secretsmanager_secret"],
            "categories": ["compliance"],
            "risk": "If not solved, there is a risk of potential unauthorized access, lack of tracking or auditing, non-compliance with data retention policies, and increased exposure time for potential breaches.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_secretsmanager_secret) and last_accessed_date < {{secret_too_old_age.from_now}}"
            },
            "default_values": {
                "secret_too_old_age": "90d"
            },
            "remediation": {
                "text": "To fix the issue, retrieve the details of a secret and view the LastAccessedDate to identify unused secrets.",
                "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
            },
            "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
        },
        {
            "name": "secret_not_changed_90d",
            "title": "Ensure Secrets are Rotated Every 90 Days",
            "result_kinds": ["aws_secretsmanager_secret"],
            "categories": ["compliance"],
            "risk": "If secrets are not changed in the last 90 days, it indicates that they are no longer in use and can be removed.",
            "severity": "medium",
            "detect": {
                "resoto": "is(aws_secretsmanager_secret) and last_changed_date<{{secret_too_old_age.from_now}}"
            },
            "default_values": {
                "secret_too_old_age": "90d"
            },
            "remediation": {
                "text": "Set up automated or manual remediation to rotate old/expired credentials.",
                "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
            },
            "url": "https://docs.aws.amazon.com/secretsmanager/latest/userguide/rotating-secrets.html"
        },
        {
            "name": "secret_rotated_as_scheduled",
            "title": "Ensure secrets rotation is error-free and timely",
            "result_kinds": ["aws_account"],
            "categories": ["security", "compliance"],
            "risk": "Failure to solve this issue may result in errors or issues with secrets rotation, compromising the security and compliance of the AWS cloud infrastructure.",
            "severity": "medium",
            "detect": {
                "manual": "To verify if secrets are being rotated manually, use the AWS Secrets CLI to describe Secrets and check the LastRotatedDate for any issues with manual/automatic rotation."
            },
            "remediation": {
                "text": "Retrieve the details of a secret using the DescribeSecret API call to view the LastRotatedDate and assess if any corrective action is required.",
                "url": "https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_DescribeSecret.html"
            },
            "url": "https://docs.aws.amazon.com/secretsmanager/latest/apireference/API_DescribeSecret.html"
        }
    ]
}
